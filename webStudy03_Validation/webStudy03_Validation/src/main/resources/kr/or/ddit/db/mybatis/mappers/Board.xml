<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.IBoardDAO">

	<sql id="fromFrag">
		FROM BOARDVIEW
	</sql>
	<sql id="searchFrag">
		<trim prefix="WHERE" prefixOverrides="AND" suffixOverrides="OR"> 
		    BO_SORT = 1 OR 1 = 1
		    <if test="searchMap!=null and @org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.searchWord)">
		        <trim prefix="AND (" suffix=")">
		            <choose>
		                <when test="searchMap.searchType eq 'title'">
		                    INSTR(BO_TITLE, #{searchMap.searchWord}) > 0
		                </when>
		                <when test="searchMap.searchType eq 'writer'">
		                    INSTR(BO_WRITER, #{searchMap.searchWord}) > 0
		                </when>
		                <when test="searchMap.searchType eq 'content'">
		                    INSTR(BO_CONTENT, #{searchMap.searchWord}) > 0
		                </when>
		                <when test="searchMap.searchType eq 'type'">
		                    BO_TYPE = #{searchMap.searchWord}
		                </when>
		                <otherwise>
		                    INSTR(BO_TITLE, #{searchMap.searchWord}) > 0
		                    OR 
		                    INSTR(BO_WRITER, #{searchMap.searchWord}) > 0
		                    OR
		                    INSTR(BO_CONTENT, #{searchMap.searchWord}) > 0
		                    OR
		                    BO_TYPE = #{searchMap.searchWord}
		                </otherwise>
		            </choose>
		        </trim>
		    </if>
		    <trim prefix="AND (" suffix=")" prefixOverrides="AND">
		        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.startDate)">
		            AND BO_DATE >= TO_DATE(#{searchMap.startDate}, 'YYYY-MM-DD') 
		        </if>
		        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchMap.endDate)">
		            <![CDATA[
		            AND BO_DATE <= TO_DATE(#{searchMap.endDate}, 'YYYY-MM-DD')
		            ]]> 
		        </if>
		    </trim>	
		</trim>
	</sql>

	<select id="selectBoardList" parameterType="PagingVO" resultType="BoardVO">
		SELECT B.*
		FROM
			(SELECT A.*, ROWNUM-3 RNUM
				FROM(
					SELECT  *
					<include refid="fromFrag"/>
					<include refid="searchFrag"></include>
				) A
			) B
		<![CDATA[
			WHERE bo_sort=1 or RNUM >= #{startRow} AND RNUM <= #{endRow}
		]]>
	</select>
	
	<select id="selectBoardCount" resultType="int" parameterType="pagingVO">
		SELECT COUNT(*)
		<include refid="fromFrag"/>
		<include refid="searchFrag" />
	</select>
</mapper>